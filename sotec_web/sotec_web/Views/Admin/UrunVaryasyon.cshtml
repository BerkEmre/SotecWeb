@using System.Data
@using sotec_firma.Helpers
@{
    ViewBag.Title = "Ürün Varyasyonları";
    DataTable dt_diller_vs;
    DataTable dt_urun_varyasyonlari = SQL.get("SELECT * FROM urun_varyasyonlari WHERE silindi = 0");

    bool first = true;
}
@section style{
    <style>
        .liss * {
            margin: 0;
            padding: 0;
            list-style: none;
        }

        .liss ul li {
            margin-left: 15px;
            position: relative;
            padding-left: 5px;
        }

            .liss ul li::before {
                content: " ";
                position: absolute;
                width: 1px;
                background-color: #000;
                top: 5px;
                bottom: -12px;
                left: -10px;
            }

        .liss body > ul > li:first-child::before {
            top: 12px;
        }

        .liss ul li:not(:first-child):last-child::before {
            display: none;
        }

        .liss ul li:only-child::before {
            display: list-item;
            content: " ";
            position: absolute;
            width: 1px;
            background-color: #000;
            top: 5px;
            bottom: 7px;
            height: 7px;
            left: -10px;
        }

        .liss ul li::after {
            content: " ";
            position: absolute;
            left: -10px;
            width: 10px;
            height: 1px;
            background-color: #000;
            top: 12px;
        }
    </style>
}
@section script {
    <script>
        function varyasyon_sil(varyasyon_id) {
            swal({
                title: "Silmek istediğinizden emin misiniz?",
                text: "Silinen varyasyon geri getirilemez!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Evet, sil!",
                cancelButtonText: "Hayır",
                closeOnConfirm: false
            },
                function () {
                    window.location = "/Admin/varyasyonSil?varyasyon_id=" + varyasyon_id;
                });
        }
        function deger_sil(varyasyon_deger_id) {
            swal({
                title: "Silmek istediğinizden emin misiniz?",
                text: "Silinen varyasyon değeri geri getirilemez!",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-danger",
                confirmButtonText: "Evet, sil!",
                cancelButtonText: "Hayır",
                closeOnConfirm: false
            },
                function () {
                    window.location = "/Admin/varyasyonDegerSil?varyasyon_deger_id=" + varyasyon_deger_id;
                });
        }
    </script>
}

<div class="row clearfix">
    @{ if (Request.Params["hata"] != null)
        {<div class="alert alert-danger col-md-12" role="alert">@Request.Params["hata"]</div>} }
    @{ if (Request.Params["tepki"] != null)
        {
            if (Request.Params["tepki"].ToString() == "1")
            { <div class="alert alert-success col-md-12" role="alert">Tebrikler, yeni varyasyon eklendi...</div> }
            if (Request.Params["tepki"].ToString() == "2")
            { <div class="alert alert-success col-md-12" role="alert">Tebrikler, varyasyon güncellendi...</div> }
            if (Request.Params["tepki"].ToString() == "3")
            { <div class="alert alert-info col-md-12" role="alert">Varyasyon silindi...</div> }

        }
    }
    <div class="col-md-12">
        <div class="card">
            <div class="header">
                <div class="pull-right"><a href="javascript:void(0);" class="btn btn-sm btn-primary" data-toggle="modal" data-target="#varyasyon_ekle"><i class="fa fa-plus"></i> Yeni Varyasyon</a></div>
            </div>
            <div class="body">
                VARYASYONLAR
                <ul class="liss">
                    @foreach (DataRow item1 in dt_urun_varyasyonlari.Rows)
                    {
                        <li>
                            @item1["varyasyon"]
                            <a href="javascript:void(0);" data-toggle="modal" data-target="#varyasyon_duzenle_@item1["urun_varyasyon_id"]"><i class="fa fa-edit"></i></a>
                            <a href="javascript:void(0);" data-toggle="modal" data-target="#varyasyon_dil_@item1["urun_varyasyon_id"]"><i class="fa fa-flag"></i></a>
                            <a href="javascript:void(0);" data-toggle="modal" data-target="#deger_ekle_@item1["urun_varyasyon_id"]"><i class="fa fa-plus"></i></a>
                            <ul>
                                @foreach (DataRow item2 in SQL.get("SELECT * FROM urun_varyasyon_degerleri WHERE silindi = 0 AND varyasyon_id = " + item1["urun_varyasyon_id"]).Rows)
                                {
                                    <li>
                                        @item2["deger"]
                                        <a href="javascript:void(0);" data-toggle="modal" data-target="#deger_duzenle_@item2["urun_varyasyon_deger_id"]"><i class="fa fa-edit"></i></a>
                                        <a href="javascript:void(0);" data-toggle="modal" data-target="#deger_dil_@item2["urun_varyasyon_deger_id"]"><i class="fa fa-flag"></i></a>
                                    </li>
                                }
                            </ul>
                        </li>
                    }
                </ul>
            </div>
        </div>
    </div>
</div>

@foreach (DataRow item1 in dt_urun_varyasyonlari.Rows)
{
    <div class="modal fade" id="varyasyon_duzenle_@item1["urun_varyasyon_id"]" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                @using (Html.BeginForm("varyasyonDuzenle", "Admin", FormMethod.Post))
                {
                    <input type="hidden" name="varyasyon_id" value="@item1["urun_varyasyon_id"]" />
                    <div class="modal-header">
                        <h6 class="title" id="defaultModalLabel">Varyasyon Düzenle</h6>
                    </div>
                    <div class="modal-body">
                        <div class="row clearfix">
                            <div class="col-12">
                                <div class="form-group">
                                    <label class="control-label">Varyasyon</label>
                                    @Html.TextBox("varyasyon", item1["varyasyon"], new { @type = "text", @class = "form-control", @placeholder = "Varyasyon", @autocomplete = "off" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Düzenle</button>
                        <button onclick="varyasyon_sil(@item1["urun_varyasyon_id"])" type="button" class="btn btn-danger">Sil</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="modal fade" id="varyasyon_dil_@item1["urun_varyasyon_id"]" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                @using (Html.BeginForm("varyasyonDil", "Admin", FormMethod.Post))
                {
                    <div class="modal-header">
                        <h6 class="title" id="defaultModalLabel">Varyasyon Dilleri</h6>
                    </div>
                    <input type="hidden" name="varyasyon_id" value="@item1["urun_varyasyon_id"]" />
                    <div class="modal-body">
                        <div class="body">
                            <ul class="nav nav-tabs">
                                @{
                                    first = true;
                                    dt_diller_vs = SQL.get("SELECT * FROM diller WHERE silindi = 0 AND varsayilan = 0");
                                }
                                @foreach (DataRow item2 in dt_diller_vs.Rows)
                                {
                                    <li class="nav-item"><a class="nav-link @(first == true ? "active show" : "") " data-toggle="tab" href="#dil_@(item1["urun_varyasyon_id"] + "_" + item2["dil_id"])">@item2["dil"]</a></li>
                                    if (first)
                                    {
                                        first = false;
                                    }
                                }
                            </ul>

                            <div class="tab-content">
                                @{
                                    first = true;
                                    dt_diller_vs = SQL.get("SELECT d.*, dk.varyasyon FROM diller d LEFT OUTER JOIN dil_urun_varyasyonlari dk ON dk.dil_id = d.dil_id AND dk.urun_varyasyon_id = " + item1["urun_varyasyon_id"] + " WHERE d.silindi = 0 AND d.varsayilan = 0");
                                }
                                @foreach (DataRow item2 in dt_diller_vs.Rows)
                                {
                                    <input type="hidden" name="dil_id[]" value="@item2["dil_id"]" />
                                    <div class="tab-pane @(first ? "active show" : "")" id="dil_@(item1["urun_varyasyon_id"] + "_" + item2["dil_id"])">
                                        <h6>@item2["dil"]</h6>
                                        <div class="row clearfix">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label">Varyasyon</label>
                                                    <input name="varyasyon[]" type="text" class="form-control" placeholder="Varyasyon" autocomplete="off" value="@item2["varyasyon"]" />
                                                    <span class="text-muted small">@item1["varyasyon"]</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    if (first)
                                    {
                                        first = false;
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Düzenle</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="modal fade" id="deger_ekle_@item1["urun_varyasyon_id"]" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                @using (Html.BeginForm("varyasyonDegerEkle", "Admin", FormMethod.Post))
                {
                    <input type="hidden" name="varyasyon_id" value="@item1["urun_varyasyon_id"]" />
                    <div class="modal-header">
                        <h6 class="title" id="defaultModalLabel">Değer Ekle</h6>
                    </div>
                    <div class="modal-body">
                        <div class="row clearfix">
                            <div class="col-12">
                                <div class="form-group">
                                    <label class="control-label">Değer</label>
                                    @Html.TextBox("deger", null, new { @type = "text", @class = "form-control", @placeholder = "Değer", @autocomplete = "off" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Ekle</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                    </div>
                }
            </div>
        </div>
    </div>
}

@foreach (DataRow item2 in SQL.get("SELECT * FROM urun_varyasyon_degerleri WHERE silindi = 0").Rows)
{
    <div class="modal fade" id="deger_duzenle_@item2["urun_varyasyon_deger_id"]" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                @using (Html.BeginForm("varyasyonDegerDuzenle", "Admin", FormMethod.Post))
                {
                    <input type="hidden" name="varyasyon_deger_id" value="@item2["urun_varyasyon_deger_id"]" />
                    <div class="modal-header">
                        <h6 class="title" id="defaultModalLabel">Varyasyon Değer Düzenle</h6>
                    </div>
                    <div class="modal-body">
                        <div class="row clearfix">
                            <div class="col-12">
                                <div class="form-group">
                                    <label class="control-label">Değer</label>
                                    @Html.TextBox("deger", item2["deger"], new { @type = "text", @class = "form-control", @placeholder = "Değer", @autocomplete = "off" })
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Düzenle</button>
                        <button onclick="deger_sil(@item2["urun_varyasyon_deger_id"])" type="button" class="btn btn-danger">Sil</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="modal fade" id="deger_dil_@item2["urun_varyasyon_deger_id"]" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                @using (Html.BeginForm("varyasyonDegerDil", "Admin", FormMethod.Post))
                {
                    <div class="modal-header">
                        <h6 class="title" id="defaultModalLabel">Varyasyon Dilleri</h6>
                    </div>
                    <input type="hidden" name="varyasyon_deger_id" value="@item2["urun_varyasyon_deger_id"]" />
                    <div class="modal-body">
                        <div class="body">
                            <ul class="nav nav-tabs">
                                @{
                                    first = true;
                                    dt_diller_vs = SQL.get("SELECT * FROM diller WHERE silindi = 0 AND varsayilan = 0");
                                }
                                @foreach (DataRow item3 in dt_diller_vs.Rows)
                                {
                                    <li class="nav-item"><a class="nav-link @(first == true ? "active show" : "") " data-toggle="tab" href="#dil1_@(item3["dil_id"] + "_" + item2["urun_varyasyon_deger_id"])">@item3["dil"]</a></li>
                                    if (first)
                                    {
                                        first = false;
                                    }
                                }
                            </ul>

                            <div class="tab-content">
                                @{
                                    first = true;
                                    dt_diller_vs = SQL.get("SELECT d.*, dk.deger FROM diller d LEFT OUTER JOIN dil_urun_varyasyon_degerleri dk ON dk.dil_id = d.dil_id AND dk.urun_varyasyon_deger_id = " + item2["urun_varyasyon_deger_id"] + " WHERE d.silindi = 0 AND d.varsayilan = 0");
                                }
                                @foreach (DataRow item3 in dt_diller_vs.Rows)
                                {
                                    <input type="hidden" name="dil_id[]" value="@item3["dil_id"]" />
                                    <div class="tab-pane @(first ? "active show" : "")" id="dil1_@(item3["dil_id"] + "_" + item2["urun_varyasyon_deger_id"])">
                                        <h6>@item3["dil"]</h6>
                                        <div class="row clearfix">
                                            <div class="col-md-12">
                                                <div class="form-group">
                                                    <label class="control-label">Değer</label>
                                                    <input name="deger[]" type="text" class="form-control" placeholder="Değer" autocomplete="off" value="@item3["deger"]" />
                                                    <span class="text-muted small">@item2["deger"]</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    if (first)
                                    {
                                        first = false;
                                    }
                                }
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">Düzenle</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                    </div>
                }
            </div>
        </div>
    </div>
}

<div class="modal fade" id="varyasyon_ekle" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            @using (Html.BeginForm("varyasyonEkle", "Admin", FormMethod.Post))
            {
                <div class="modal-header">
                    <h6 class="title" id="defaultModalLabel">Varyasyon Ekle</h6>
                </div>
                <div class="modal-body">
                    <div class="row clearfix">
                        <div class="col-12">
                            <div class="form-group">
                                <label class="control-label">Varysayon</label>
                                @Html.TextBox("varyasyon", null, new { @type = "text", @class = "form-control", @placeholder = "Varyasyon", @autocomplete = "off" })
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Ekle</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">İptal</button>
                </div>
            }
        </div>
    </div>
</div>



